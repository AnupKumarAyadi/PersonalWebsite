<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outliers and Statistics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            color: #1a1a1a;
            line-height: 1.6;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 30px;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2em;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #666;
            font-size: 1em;
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 968px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            padding: 30px;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a1a1a;
        }

        canvas {
            width: 100%;
            height: 400px;
            background: white;
            border: 1px solid #e5e5e5;
            image-rendering: crisp-edges;
            image-rendering: -moz-crisp-edges;
            image-rendering: pixelated;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: white;
            border: 1px solid #e5e5e5;
            padding: 20px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 600;
            color: #1a1a1a;
        }

        .stat-change {
            font-size: 14px;
            margin-top: 5px;
            font-weight: 500;
        }

        .stat-change.positive {
            color: #dc2626;
        }

        .stat-change.negative {
            color: #16a34a;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            background: #1a1a1a;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.8;
        }

        button.secondary {
            background: #fafafa;
            color: #1a1a1a;
            border: 1px solid #e5e5e5;
        }

        button.secondary:hover {
            background: #f0f0f0;
        }

        button.danger {
            background: #dc2626;
        }

        .instructions {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            padding: 20px;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-line {
            width: 30px;
            height: 2px;
            background: #1a1a1a;
        }

        .legend-line.dashed {
            background: repeating-linear-gradient(
                to right,
                #1a1a1a 0px,
                #1a1a1a 5px,
                transparent 5px,
                transparent 10px
            );
        }

        .legend-line.median {
            background: #666;
        }

        .legend-line.median.dashed {
            background: repeating-linear-gradient(
                to right,
                #666 0px,
                #666 5px,
                transparent 5px,
                transparent 10px
            );
        }

        .legend-box {
            width: 20px;
            height: 20px;
            background: rgba(26, 26, 26, 0.1);
            border: 1px solid #1a1a1a;
        }

        .theory-section {
            border-top: 1px solid #e5e5e5;
            padding-top: 40px;
            margin-top: 40px;
        }

        .theory-section h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .theory-section h3 {
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .theory-section p {
            color: #666;
            margin-bottom: 15px;
            font-size: 15px;
        }

        .formula {
            background: white;
            border: 1px solid #e5e5e5;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 16px;
        }

        .highlight {
            background: #fafafa;
            border-left: 3px solid #1a1a1a;
            padding: 15px 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Outliers and Their Effect on Statistics</h1>
            <p class="subtitle">Interactive visualization showing how outliers dramatically impact mean and standard deviation</p>
        </header>

        <div class="instructions">
            <strong>Instructions:</strong> Start with a normal distribution, then add outliers to see their dramatic effect. Watch how the mean shifts and standard deviation increases, while the median stays relatively stable.
        </div>

        <div class="simulation-area">
            <div class="panel">
                <h2>Distribution Histogram</h2>
                <canvas id="histogramCanvas"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-line dashed"></div>
                        <span>Mean</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line median dashed"></div>
                        <span>Median</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box"></div>
                        <span>±1 Std Dev</span>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="addLowOutlier()">Add Low Outlier</button>
                    <button onclick="addHighOutlier()">Add High Outlier</button>
                    <button class="danger" onclick="addMultipleOutliers()">Add 5 Outliers</button>
                    <button class="secondary" onclick="resetData()">Reset</button>
                </div>
            </div>

            <div class="panel">
                <h2>Statistical Measures</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Mean</div>
                        <div class="stat-value" id="meanValue">50.0</div>
                        <div class="stat-change" id="meanChange"></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Median</div>
                        <div class="stat-value" id="medianValue">50.0</div>
                        <div class="stat-change" id="medianChange"></div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Std Dev</div>
                        <div class="stat-value" id="stdDevValue">8.5</div>
                        <div class="stat-change" id="stdDevChange"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="theory-section">
            <h2>Understanding Statistics and Outliers</h2>

            <h3>What Are Outliers?</h3>
            <p>Outliers are data points that differ significantly from other observations in a dataset. They lie at an abnormal distance from the majority of values and can arise from measurement errors, data entry mistakes, or genuine extreme variations in the population being studied. Outliers can have a profound impact on statistical measures, making it crucial to identify and understand them when analyzing data.</p>

            <h3>Measures of Central Tendency</h3>
            
            <p><strong>Mean (Arithmetic Average):</strong> The mean is calculated by summing all values and dividing by the number of observations. It is highly sensitive to outliers because every value in the dataset, including extreme ones, contributes equally to the calculation.</p>
            
            <div class="formula">
                Mean = (Σx) / n
                <br>where Σx is the sum of all values and n is the number of values
            </div>

            <div class="highlight">
                <strong>Impact of Outliers on Mean:</strong> A single extreme value can drastically pull the mean toward it, making it unrepresentative of the typical data. For example, in a dataset of home prices, one mansion worth $10 million among houses averaging $300,000 would significantly inflate the mean price. In the simulation above, notice how adding just one outlier shifts the mean dramatically away from the center of the distribution.
            </div>

            <p><strong>Median:</strong> The median is the middle value when data is arranged in order. If there's an even number of values, it's the average of the two middle values. The median is resistant to outliers because it only depends on the middle position(s), not the actual values of extreme data points.</p>

            <div class="highlight">
                <strong>Impact of Outliers on Median:</strong> The median remains stable even when outliers are present. This makes it a more reliable measure of central tendency for skewed distributions or datasets with extreme values. The median better represents the "typical" value in such cases. In the simulation, observe how the median barely moves even when you add multiple outliers.
            </div>

            <h3>Standard Deviation</h3>
            
            <p>Standard deviation measures the spread or dispersion of data around the mean. It quantifies how much individual values typically deviate from the average. A larger standard deviation indicates greater variability in the data.</p>

            <div class="formula">
                σ = √[(Σ(x - μ)²) / n]
                <br>where x is each value, μ is the mean, and n is the number of values
            </div>

            <div class="highlight">
                <strong>Impact of Outliers on Standard Deviation:</strong> Outliers dramatically increase standard deviation because the calculation involves squared differences from the mean. Since outliers are far from the mean, their squared deviations are very large, substantially inflating the overall measure of spread. This can make the data appear more variable than it truly is for the majority of observations. In the visualization, the shaded area (representing ±1 standard deviation) expands significantly when outliers are added.
            </div>

            <h3>Why This Matters</h3>
            
            <p>Understanding how outliers affect different statistics is essential for proper data analysis. When reporting central tendency, choosing between mean and median depends on your data's distribution. For symmetric distributions without outliers, the mean provides useful information. For skewed distributions or datasets with outliers, the median often gives a more accurate picture of the typical value.</p>

            <p>Similarly, when describing variability, be aware that standard deviation can be misleading in the presence of outliers. The shaded region in the histogram shows ±1 standard deviation from the mean. In a normal distribution, about 68% of data falls within this range. However, when outliers are present, the standard deviation inflates and this interpretation becomes less meaningful.</p>

            <p>In real-world applications—from income analysis to scientific measurements to quality control—recognizing and appropriately handling outliers ensures that statistical summaries accurately represent the underlying data and lead to valid conclusions. The dramatic visual changes in the simulation demonstrate why statisticians often report both mean and median, and why data exploration and visualization are critical steps before conducting formal statistical analysis.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('histogramCanvas');
        const ctx = canvas.getContext('2d');

        let dataPoints = [];
        let baselineStats = { mean: 0, median: 0, stdDev: 0 };

        // Set canvas size with proper pixel ratio
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            
            ctx.scale(dpr, dpr);
            
            drawHistogram();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Initialize with normal distribution
        function resetData() {
            dataPoints = [];
            // Generate normal distribution centered at 50
            for (let i = 0; i < 100; i++) {
                dataPoints.push(normalRandom(50, 8));
            }
            baselineStats = calculateStats();
            drawHistogram();
            updateStats();
        }

        // Box-Muller transform for normal distribution
        function normalRandom(mean, stdDev) {
            let u = 0, v = 0;
            while(u === 0) u = Math.random();
            while(v === 0) v = Math.random();
            const num = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            return num * stdDev + mean;
        }

        function addLowOutlier() {
            dataPoints.push(5 + Math.random() * 10);
            drawHistogram();
            updateStats();
        }

        function addHighOutlier() {
            dataPoints.push(85 + Math.random() * 10);
            drawHistogram();
            updateStats();
        }

        function addMultipleOutliers() {
            for (let i = 0; i < 3; i++) {
                dataPoints.push(5 + Math.random() * 10);
            }
            for (let i = 0; i < 2; i++) {
                dataPoints.push(85 + Math.random() * 10);
            }
            drawHistogram();
            updateStats();
        }

        function calculateStats() {
            if (dataPoints.length === 0) {
                return { mean: 0, median: 0, stdDev: 0 };
            }

            const sorted = [...dataPoints].sort((a, b) => a - b);
            const n = sorted.length;

            // Mean
            const mean = dataPoints.reduce((a, b) => a + b, 0) / n;

            // Median
            const median = n % 2 === 0 
                ? (sorted[n/2 - 1] + sorted[n/2]) / 2 
                : sorted[Math.floor(n/2)];

            // Standard deviation
            const variance = dataPoints.reduce((sum, val) => 
                sum + (val - mean) ** 2, 0) / n;
            const stdDev = Math.sqrt(variance);

            return { mean, median, stdDev };
        }

        function drawHistogram() {
            const rect = canvas.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;
            const margin = 60;
            const plotWidth = width - 2 * margin;
            const plotHeight = height - 2 * margin;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (dataPoints.length === 0) return;

            const stats = calculateStats();

            // Create histogram bins
            const binCount = 30;
            const minVal = 0;
            const maxVal = 100;
            const binWidth = (maxVal - minVal) / binCount;
            const bins = new Array(binCount).fill(0);

            dataPoints.forEach(val => {
                const binIndex = Math.min(Math.floor((val - minVal) / binWidth), binCount - 1);
                if (binIndex >= 0 && binIndex < binCount) {
                    bins[binIndex]++;
                }
            });

            const maxBinCount = Math.max(...bins);

            // Draw axes
            ctx.strokeStyle = '#e5e5e5';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, height - margin);
            ctx.lineTo(width - margin, height - margin);
            ctx.stroke();

            // Draw x-axis labels
            ctx.fillStyle = '#666';
            ctx.font = '12px Inter, sans-serif';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 10; i++) {
                const val = i * 10;
                const x = margin + (val / 100) * plotWidth;
                ctx.fillText(val, x, height - margin + 20);
            }

            // Y-axis label
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Frequency', 0, 0);
            ctx.restore();

            // Draw histogram bars
            ctx.fillStyle = 'rgba(26, 26, 26, 0.7)';
            bins.forEach((count, i) => {
                const x = margin + (i / binCount) * plotWidth;
                const barWidth = plotWidth / binCount;
                const barHeight = (count / maxBinCount) * plotHeight;
                const y = height - margin - barHeight;
                
                ctx.fillRect(x, y, barWidth - 1, barHeight);
            });

            // Draw standard deviation shaded area
            const stdLeft = ((stats.mean - stats.stdDev) / 100) * plotWidth + margin;
            const stdRight = ((stats.mean + stats.stdDev) / 100) * plotWidth + margin;
            
            ctx.fillStyle = 'rgba(26, 26, 26, 0.1)';
            ctx.fillRect(stdLeft, margin, stdRight - stdLeft, plotHeight);

            // Draw std dev borders
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(stdLeft, margin);
            ctx.lineTo(stdLeft, height - margin);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(stdRight, margin);
            ctx.lineTo(stdRight, height - margin);
            ctx.stroke();

            // Draw mean line
            const meanX = (stats.mean / 100) * plotWidth + margin;
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(meanX, margin);
            ctx.lineTo(meanX, height - margin);
            ctx.stroke();

            // Draw median line
            const medianX = (stats.median / 100) * plotWidth + margin;
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(medianX, margin);
            ctx.lineTo(medianX, height - margin);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels for mean and median
            ctx.fillStyle = '#1a1a1a';
            ctx.font = '12px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Mean', meanX, margin - 10);

            ctx.fillStyle = '#666';
            ctx.fillText('Median', medianX, margin - 25);
        }

        function updateStats() {
            const stats = calculateStats();
            
            document.getElementById('meanValue').textContent = stats.mean.toFixed(1);
            document.getElementById('medianValue').textContent = stats.median.toFixed(1);
            document.getElementById('stdDevValue').textContent = stats.stdDev.toFixed(1);

            // Calculate changes from baseline
            const meanChange = stats.mean - baselineStats.mean;
            const medianChange = stats.median - baselineStats.median;
            const stdDevChange = stats.stdDev - baselineStats.stdDev;

            updateChangeDisplay('meanChange', meanChange);
            updateChangeDisplay('medianChange', medianChange);
            updateChangeDisplay('stdDevChange', stdDevChange);
        }

        function updateChangeDisplay(id, change) {
            const elem = document.getElementById(id);
            if (Math.abs(change) < 0.1) {
                elem.textContent = '';
                elem.className = 'stat-change';
            } else {
                const sign = change > 0 ? '+' : '';
                elem.textContent = `${sign}${change.toFixed(1)}`;
                elem.className = 'stat-change ' + (change > 0 ? 'positive' : 'negative');
            }
        }

        // Initialize
        resetData();
    </script>
</body>
</html>